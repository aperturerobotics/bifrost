//go:build deps_only

// Code generated by protoc-gen-starpc-cpp. DO NOT EDIT.
// protoc-gen-starpc-cpp version: v0.46.1
// source: github.com/aperturerobotics/bifrost/stream/api/api.proto

#include "api_srpc.pb.hpp"

namespace stream::api {

std::pair<std::unique_ptr<SRPCStreamService_ForwardStreamsClient>, starpc::Error> SRPCStreamServiceClientImpl::ForwardStreams(const stream::api::ForwardStreamsRequest& in) {
  auto [strm, err] = cc_->NewStream(service_id_, "ForwardStreams", &in);
  if (err != starpc::Error::OK) {
    return {nullptr, err};
  }
  err = strm->CloseSend();
  if (err != starpc::Error::OK) {
    return {nullptr, err};
  }
  return {std::make_unique<SRPCStreamService_ForwardStreamsClient>(std::move(strm)), starpc::Error::OK};
}

std::pair<std::unique_ptr<SRPCStreamService_ListenStreamsClient>, starpc::Error> SRPCStreamServiceClientImpl::ListenStreams(const stream::api::ListenStreamsRequest& in) {
  auto [strm, err] = cc_->NewStream(service_id_, "ListenStreams", &in);
  if (err != starpc::Error::OK) {
    return {nullptr, err};
  }
  err = strm->CloseSend();
  if (err != starpc::Error::OK) {
    return {nullptr, err};
  }
  return {std::make_unique<SRPCStreamService_ListenStreamsClient>(std::move(strm)), starpc::Error::OK};
}

std::pair<std::unique_ptr<SRPCStreamService_AcceptStreamClient>, starpc::Error> SRPCStreamServiceClientImpl::AcceptStream() {
  auto [strm, err] = cc_->NewStream(service_id_, "AcceptStream", nullptr);
  if (err != starpc::Error::OK) {
    return {nullptr, err};
  }
  return {std::make_unique<SRPCStreamService_AcceptStreamClient>(std::move(strm)), starpc::Error::OK};
}

std::pair<std::unique_ptr<SRPCStreamService_DialStreamClient>, starpc::Error> SRPCStreamServiceClientImpl::DialStream() {
  auto [strm, err] = cc_->NewStream(service_id_, "DialStream", nullptr);
  if (err != starpc::Error::OK) {
    return {nullptr, err};
  }
  return {std::make_unique<SRPCStreamService_DialStreamClient>(std::move(strm)), starpc::Error::OK};
}

std::vector<std::string> SRPCStreamServiceHandler::GetMethodIDs() const {
  return {
    "ForwardStreams",
    "ListenStreams",
    "AcceptStream",
    "DialStream",
  };
}

std::pair<bool, starpc::Error> SRPCStreamServiceHandler::InvokeMethod(
    const std::string& service_id,
    const std::string& method_id,
    starpc::Stream* strm) {
  if (!service_id.empty() && service_id != service_id_) {
    return {false, starpc::Error::OK};
  }

  if (method_id == "ForwardStreams") {
    stream::api::ForwardStreamsRequest req;
    starpc::Error err = strm->MsgRecv(&req);
    if (err != starpc::Error::OK) return {true, err};
    SRPCStreamService_ForwardStreamsStream serverStrm(strm);
    return {true, impl_->ForwardStreams(req, &serverStrm)};
  } else if (method_id == "ListenStreams") {
    stream::api::ListenStreamsRequest req;
    starpc::Error err = strm->MsgRecv(&req);
    if (err != starpc::Error::OK) return {true, err};
    SRPCStreamService_ListenStreamsStream serverStrm(strm);
    return {true, impl_->ListenStreams(req, &serverStrm)};
  } else if (method_id == "AcceptStream") {
    SRPCStreamService_AcceptStreamStream bidiStrm(strm);
    return {true, impl_->AcceptStream(&bidiStrm)};
  } else if (method_id == "DialStream") {
    SRPCStreamService_DialStreamStream bidiStrm(strm);
    return {true, impl_->DialStream(&bidiStrm)};
  }

  return {false, starpc::Error::OK};
}

}  // namespace stream::api
