// Code generated by protoc-gen-starpc-rust. DO NOT EDIT.
// protoc-gen-starpc-rust version: v0.46.1
// source: github.com/aperturerobotics/bifrost/stream/api/api.proto

#[allow(unused_imports)]
use starpc::StreamExt;

/// Service ID for StreamService.
pub const STREAM_SERVICE_SERVICE_ID: &str = "stream.api.StreamService";

/// Stream trait for StreamService.ForwardStreams.
#[starpc::async_trait]
pub trait StreamServiceForwardStreamsStream: Send + Sync {
    /// Returns the context for this stream.
    fn context(&self) -> &starpc::Context;
    /// Receives a message from the stream.
    async fn recv(&self) -> starpc::Result<ForwardStreamsResponse>;
    /// Closes the stream.
    async fn close(&self) -> starpc::Result<()>;
}

/// Stream trait for StreamService.ListenStreams.
#[starpc::async_trait]
pub trait StreamServiceListenStreamsStream: Send + Sync {
    /// Returns the context for this stream.
    fn context(&self) -> &starpc::Context;
    /// Receives a message from the stream.
    async fn recv(&self) -> starpc::Result<ListenStreamsResponse>;
    /// Closes the stream.
    async fn close(&self) -> starpc::Result<()>;
}

/// Stream trait for StreamService.AcceptStream.
#[starpc::async_trait]
pub trait StreamServiceAcceptStreamStream: Send + Sync {
    /// Returns the context for this stream.
    fn context(&self) -> &starpc::Context;
    /// Sends a message on the stream.
    async fn send(&self, msg: &AcceptStreamRequest) -> starpc::Result<()>;
    /// Receives a message from the stream.
    async fn recv(&self) -> starpc::Result<AcceptStreamResponse>;
    /// Closes the stream.
    async fn close(&self) -> starpc::Result<()>;
}

/// Stream trait for StreamService.DialStream.
#[starpc::async_trait]
pub trait StreamServiceDialStreamStream: Send + Sync {
    /// Returns the context for this stream.
    fn context(&self) -> &starpc::Context;
    /// Sends a message on the stream.
    async fn send(&self, msg: &DialStreamRequest) -> starpc::Result<()>;
    /// Receives a message from the stream.
    async fn recv(&self) -> starpc::Result<DialStreamResponse>;
    /// Closes the stream.
    async fn close(&self) -> starpc::Result<()>;
}

/// Client trait for StreamService.
#[starpc::async_trait]
pub trait StreamServiceClient: Send + Sync {
    /// ForwardStreams.
    async fn forward_streams(&self, request: &ForwardStreamsRequest) -> starpc::Result<Box<dyn StreamServiceForwardStreamsStream>>;
    /// ListenStreams.
    async fn listen_streams(&self, request: &ListenStreamsRequest) -> starpc::Result<Box<dyn StreamServiceListenStreamsStream>>;
    /// AcceptStream.
    async fn accept_stream(&self) -> starpc::Result<Box<dyn StreamServiceAcceptStreamStream>>;
    /// DialStream.
    async fn dial_stream(&self) -> starpc::Result<Box<dyn StreamServiceDialStreamStream>>;
}

/// Client implementation for StreamService.
pub struct StreamServiceClientImpl<C> {
    client: C,
}

impl<C: starpc::Client> StreamServiceClientImpl<C> {
    /// Creates a new client.
    pub fn new(client: C) -> Self {
        Self { client }
    }
}

#[starpc::async_trait]
impl<C: starpc::Client + 'static> StreamServiceClient for StreamServiceClientImpl<C> {
    async fn forward_streams(&self, request: &ForwardStreamsRequest) -> starpc::Result<Box<dyn StreamServiceForwardStreamsStream>> {
        use starpc::ProstMessage;
        let data = request.encode_to_vec();
        let stream = self.client.new_stream("stream.api.StreamService", "ForwardStreams", Some(&data)).await?;
        stream.close_send().await?;
        Ok(Box::new(StreamServiceForwardStreamsStreamImpl { stream }))
    }
    async fn listen_streams(&self, request: &ListenStreamsRequest) -> starpc::Result<Box<dyn StreamServiceListenStreamsStream>> {
        use starpc::ProstMessage;
        let data = request.encode_to_vec();
        let stream = self.client.new_stream("stream.api.StreamService", "ListenStreams", Some(&data)).await?;
        stream.close_send().await?;
        Ok(Box::new(StreamServiceListenStreamsStreamImpl { stream }))
    }
    async fn accept_stream(&self) -> starpc::Result<Box<dyn StreamServiceAcceptStreamStream>> {
        let stream = self.client.new_stream("stream.api.StreamService", "AcceptStream", None).await?;
        Ok(Box::new(StreamServiceAcceptStreamStreamImpl { stream }))
    }
    async fn dial_stream(&self) -> starpc::Result<Box<dyn StreamServiceDialStreamStream>> {
        let stream = self.client.new_stream("stream.api.StreamService", "DialStream", None).await?;
        Ok(Box::new(StreamServiceDialStreamStreamImpl { stream }))
    }
}

struct StreamServiceForwardStreamsStreamImpl {
    stream: Box<dyn starpc::Stream>,
}

#[starpc::async_trait]
impl StreamServiceForwardStreamsStream for StreamServiceForwardStreamsStreamImpl {
    fn context(&self) -> &starpc::Context {
        self.stream.context()
    }
    async fn recv(&self) -> starpc::Result<ForwardStreamsResponse> {
        self.stream.msg_recv().await
    }
    async fn close(&self) -> starpc::Result<()> {
        self.stream.close().await
    }
}

struct StreamServiceListenStreamsStreamImpl {
    stream: Box<dyn starpc::Stream>,
}

#[starpc::async_trait]
impl StreamServiceListenStreamsStream for StreamServiceListenStreamsStreamImpl {
    fn context(&self) -> &starpc::Context {
        self.stream.context()
    }
    async fn recv(&self) -> starpc::Result<ListenStreamsResponse> {
        self.stream.msg_recv().await
    }
    async fn close(&self) -> starpc::Result<()> {
        self.stream.close().await
    }
}

struct StreamServiceAcceptStreamStreamImpl {
    stream: Box<dyn starpc::Stream>,
}

#[starpc::async_trait]
impl StreamServiceAcceptStreamStream for StreamServiceAcceptStreamStreamImpl {
    fn context(&self) -> &starpc::Context {
        self.stream.context()
    }
    async fn send(&self, msg: &AcceptStreamRequest) -> starpc::Result<()> {
        self.stream.msg_send(msg).await
    }
    async fn recv(&self) -> starpc::Result<AcceptStreamResponse> {
        self.stream.msg_recv().await
    }
    async fn close(&self) -> starpc::Result<()> {
        self.stream.close().await
    }
}

struct StreamServiceDialStreamStreamImpl {
    stream: Box<dyn starpc::Stream>,
}

#[starpc::async_trait]
impl StreamServiceDialStreamStream for StreamServiceDialStreamStreamImpl {
    fn context(&self) -> &starpc::Context {
        self.stream.context()
    }
    async fn send(&self, msg: &DialStreamRequest) -> starpc::Result<()> {
        self.stream.msg_send(msg).await
    }
    async fn recv(&self) -> starpc::Result<DialStreamResponse> {
        self.stream.msg_recv().await
    }
    async fn close(&self) -> starpc::Result<()> {
        self.stream.close().await
    }
}

/// Server trait for StreamService.
#[starpc::async_trait]
pub trait StreamServiceServer: Send + Sync {
    /// ForwardStreams.
    async fn forward_streams(&self, request: ForwardStreamsRequest, stream: Box<dyn starpc::Stream>) -> starpc::Result<()>;
    /// ListenStreams.
    async fn listen_streams(&self, request: ListenStreamsRequest, stream: Box<dyn starpc::Stream>) -> starpc::Result<()>;
    /// AcceptStream.
    async fn accept_stream(&self, stream: Box<dyn starpc::Stream>) -> starpc::Result<()>;
    /// DialStream.
    async fn dial_stream(&self, stream: Box<dyn starpc::Stream>) -> starpc::Result<()>;
}

const STREAM_SERVICE_METHOD_IDS: &[&str] = &[
    "ForwardStreams",
    "ListenStreams",
    "AcceptStream",
    "DialStream",
];

/// Handler for StreamService.
pub struct StreamServiceHandler<S: StreamServiceServer> {
    server: std::sync::Arc<S>,
}

impl<S: StreamServiceServer + 'static> StreamServiceHandler<S> {
    /// Creates a new handler wrapping the server implementation.
    pub fn new(server: S) -> Self {
        Self { server: std::sync::Arc::new(server) }
    }

    /// Creates a new handler with a shared server.
    pub fn with_arc(server: std::sync::Arc<S>) -> Self {
        Self { server }
    }
}

#[starpc::async_trait]
impl<S: StreamServiceServer + 'static> starpc::Invoker for StreamServiceHandler<S> {
    async fn invoke_method(
        &self,
        _service_id: &str,
        method_id: &str,
        stream: Box<dyn starpc::Stream>,
    ) -> (bool, starpc::Result<()>) {
        match method_id {
            "ForwardStreams" => {
                let request: ForwardStreamsRequest = match stream.msg_recv().await {
                    Ok(r) => r,
                    Err(e) => return (true, Err(e)),
                };
                (true, self.server.forward_streams(request, stream).await)
            }
            "ListenStreams" => {
                let request: ListenStreamsRequest = match stream.msg_recv().await {
                    Ok(r) => r,
                    Err(e) => return (true, Err(e)),
                };
                (true, self.server.listen_streams(request, stream).await)
            }
            "AcceptStream" => {
                (true, self.server.accept_stream(stream).await)
            }
            "DialStream" => {
                (true, self.server.dial_stream(stream).await)
            }
            _ => (false, Err(starpc::Error::Unimplemented)),
        }
    }
}

impl<S: StreamServiceServer + 'static> starpc::Handler for StreamServiceHandler<S> {
    fn service_id(&self) -> &'static str {
        "stream.api.StreamService"
    }

    fn method_ids(&self) -> &'static [&'static str] {
        STREAM_SERVICE_METHOD_IDS
    }
}

