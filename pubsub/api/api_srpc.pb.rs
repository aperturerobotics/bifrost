// Code generated by protoc-gen-starpc-rust. DO NOT EDIT.
// protoc-gen-starpc-rust version: v0.45.1-0.20260203090429-3e915608d4e8
// source: github.com/aperturerobotics/bifrost/pubsub/api/api.proto

#[allow(unused_imports)]
use starpc::StreamExt;

/// Service ID for PubSubService.
pub const PUB_SUB_SERVICE_SERVICE_ID: &str = "pubsub.api.PubSubService";

/// Stream trait for PubSubService.Subscribe.
#[starpc::async_trait]
pub trait PubSubServiceSubscribeStream: Send + Sync {
    /// Returns the context for this stream.
    fn context(&self) -> &starpc::Context;
    /// Sends a message on the stream.
    async fn send(&self, msg: &SubscribeRequest) -> starpc::Result<()>;
    /// Receives a message from the stream.
    async fn recv(&self) -> starpc::Result<SubscribeResponse>;
    /// Closes the stream.
    async fn close(&self) -> starpc::Result<()>;
}

/// Client trait for PubSubService.
#[starpc::async_trait]
pub trait PubSubServiceClient: Send + Sync {
    /// Subscribe.
    async fn subscribe(&self) -> starpc::Result<Box<dyn PubSubServiceSubscribeStream>>;
}

/// Client implementation for PubSubService.
pub struct PubSubServiceClientImpl<C> {
    client: C,
}

impl<C: starpc::Client> PubSubServiceClientImpl<C> {
    /// Creates a new client.
    pub fn new(client: C) -> Self {
        Self { client }
    }
}

#[starpc::async_trait]
impl<C: starpc::Client + 'static> PubSubServiceClient for PubSubServiceClientImpl<C> {
    async fn subscribe(&self) -> starpc::Result<Box<dyn PubSubServiceSubscribeStream>> {
        let stream = self.client.new_stream("pubsub.api.PubSubService", "Subscribe", None).await?;
        Ok(Box::new(PubSubServiceSubscribeStreamImpl { stream }))
    }
}

struct PubSubServiceSubscribeStreamImpl {
    stream: Box<dyn starpc::Stream>,
}

#[starpc::async_trait]
impl PubSubServiceSubscribeStream for PubSubServiceSubscribeStreamImpl {
    fn context(&self) -> &starpc::Context {
        self.stream.context()
    }
    async fn send(&self, msg: &SubscribeRequest) -> starpc::Result<()> {
        self.stream.msg_send(msg).await
    }
    async fn recv(&self) -> starpc::Result<SubscribeResponse> {
        self.stream.msg_recv().await
    }
    async fn close(&self) -> starpc::Result<()> {
        self.stream.close().await
    }
}

/// Server trait for PubSubService.
#[starpc::async_trait]
pub trait PubSubServiceServer: Send + Sync {
    /// Subscribe.
    async fn subscribe(&self, stream: Box<dyn starpc::Stream>) -> starpc::Result<()>;
}

const PUB_SUB_SERVICE_METHOD_IDS: &[&str] = &[
    "Subscribe",
];

/// Handler for PubSubService.
pub struct PubSubServiceHandler<S: PubSubServiceServer> {
    server: std::sync::Arc<S>,
}

impl<S: PubSubServiceServer + 'static> PubSubServiceHandler<S> {
    /// Creates a new handler wrapping the server implementation.
    pub fn new(server: S) -> Self {
        Self { server: std::sync::Arc::new(server) }
    }

    /// Creates a new handler with a shared server.
    pub fn with_arc(server: std::sync::Arc<S>) -> Self {
        Self { server }
    }
}

#[starpc::async_trait]
impl<S: PubSubServiceServer + 'static> starpc::Invoker for PubSubServiceHandler<S> {
    async fn invoke_method(
        &self,
        _service_id: &str,
        method_id: &str,
        stream: Box<dyn starpc::Stream>,
    ) -> (bool, starpc::Result<()>) {
        match method_id {
            "Subscribe" => {
                (true, self.server.subscribe(stream).await)
            }
            _ => (false, Err(starpc::Error::Unimplemented)),
        }
    }
}

impl<S: PubSubServiceServer + 'static> starpc::Handler for PubSubServiceHandler<S> {
    fn service_id(&self) -> &'static str {
        "pubsub.api.PubSubService"
    }

    fn method_ids(&self) -> &'static [&'static str] {
        PUB_SUB_SERVICE_METHOD_IDS
    }
}

